name: Update output.json

on:
  schedule:
    - cron: '31 5 * * *' # Once per day, random time
  workflow_dispatch:

permissions: {}

jobs:
  update:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: './scripts/update'
    steps:
      - name: Checkout self
        uses: actions/checkout@v3

      - name: Checkout vcpkg
        uses: actions/checkout@v3
        with:
          repository: 'microsoft/vcpkg'
          path: 'vcpkg'

      - uses: actions/setup-node@v3
        with:
          node-version: '16'

      - run: npm ci

      - run: npm run start $GITHUB_WORKSPACE/vcpkg $GITHUB_TOKEN

      - uses: actions/upload-artifact@v3
        with:
          name: 'output.json'
          path: './output.json'
